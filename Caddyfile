(common) {
  header /* {
    -Server
  }
}

:{$PORT:80} {
  import common

  root * /usr/share/caddy
  encode zstd gzip

  route {
    # Use handle_path to strip /api prefix before proxying if the PHP API doesn't expect it
    # Or just use handle if it does.
    handle_path /api/* {
      root * /var/www/public
      php_fastcgi {$PHPAPI_URL:8089}
      file_server
    }

    try_files {path} {path}.html {path}/ /index.html
    file_server
  }
}
